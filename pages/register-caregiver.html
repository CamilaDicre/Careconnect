<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Careconnect - Registro de Cuidador</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../css/auth.css">
  <style>
    .caregiver-container {
      max-width: 500px;
      margin: 48px auto 32px auto;
      background: rgba(255,255,255,0.97);
      border-radius: 32px;
      box-shadow: 0 8px 40px rgba(25,118,210,0.13);
      padding: 2.5rem 2rem 2rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .caregiver-logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 1.2rem;
      animation: logoEntrance 1.1s cubic-bezier(0.23, 1, 0.32, 1);
      position: relative;
      z-index: 2;
    }
    .caregiver-logo::before {
      display: none;
    }
    .caregiver-logo img {
      width: 100px;
      height: 100px;
      border-radius: 0;
      background: transparent;
      margin-bottom: 0.3rem;
      position: relative;
      z-index: 2;
    }
    .caregiver-logo span {
      font-size: 2.3rem;
      font-weight: 800;
      color: #1565c0;
      letter-spacing: 2.5px;
      text-shadow: 0 2px 6px rgba(25,118,210,0.10), 0 1px 0 #fff;
      margin-top: 0.2rem;
      position: relative;
      z-index: 2;
    }
    @keyframes logoEntrance {
      0% { opacity: 0; transform: scale(0.7) translateY(40px) rotate(-8deg); filter: blur(2px); }
      60% { opacity: 1; transform: scale(1.08) translateY(-10px) rotate(2deg); filter: blur(0); }
      100% { opacity: 1; transform: scale(1) translateY(0) rotate(0deg); filter: blur(0); }
    }
    .caregiver-header {
      text-align: center;
      margin-bottom: 1.2rem;
    }
    .caregiver-header h1 {
      font-size: 1.7rem;
      color: #1976d2;
      margin: 0 0 0.5rem 0;
      font-weight: 700;
      letter-spacing: 1.5px;
    }
    .caregiver-header p {
      color: #1976d2;
      font-size: 1.08rem;
      margin-bottom: 0.5rem;
    }
    .caregiver-form {
      width: 100%;
      margin-top: 0.5rem;
    }
    .form-section {
      background: none;
      border-radius: 0;
      padding: 0 0 0.5rem 0;
      margin-bottom: 0.7rem;
      box-shadow: none;
      border: none;
    }
    .caregiver-form label {
      display: block;
      font-size: 1.18rem;
      font-weight: 700;
      color: #1565c0;
      margin-bottom: 0.18rem;
      margin-top: 1.1rem;
      letter-spacing: 0.7px;
      transition: color 0.2s;
      text-align: center;
    }
    .input-group {
      position: relative;
      margin-bottom: 1.1rem;
      background: #f6f8fc;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(25,118,210,0.07);
      display: flex;
      align-items: center;
      padding: 0.1rem 0.2rem 0.1rem 0.2rem;
    }
    .input-group i {
      position: absolute;
      left: 1.1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #1976d2;
      font-size: 1.35rem;
      opacity: 0.95;
      pointer-events: none;
      transition: color 0.2s;
    }
    .caregiver-form input, .caregiver-form select, .caregiver-form textarea {
      width: 100%;
      font-size: 1.15rem;
      padding: 0.95rem 1.1rem 0.95rem 2.7rem;
      border-radius: 12px;
      border: none;
      background: transparent;
      margin-bottom: 0.1rem;
      margin-top: 0.1rem;
      box-sizing: border-box;
      transition: box-shadow 0.2s, background 0.2s;
      resize: none;
      outline: none;
      color: #222;
      font-weight: 500;
      text-align: center;
    }
    .caregiver-form input:focus, .caregiver-form select:focus, .caregiver-form textarea:focus {
      background: #e3eafc;
      box-shadow: 0 0 0 2px #1976d2;
    }
    .caregiver-form select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="%231976d2" height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 1.2rem center;
      background-size: 1.3rem;
      padding-right: 2.5rem;
    }
    .caregiver-form textarea {
      min-height: 90px;
      max-height: 220px;
    }
    .caregiver-main-btn {
      width: 100%;
      font-size: 1.18rem;
      font-weight: 700;
      border-radius: 14px;
      padding: 0.9rem 0;
      background: linear-gradient(90deg, #1976d2 60%, #63a4ff 100%);
      color: #fff;
      border: none;
      margin-top: 1.1rem;
      margin-bottom: 0.3rem;
      box-shadow: 0 2px 12px rgba(25, 118, 210, 0.13);
      transition: background 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }
    .caregiver-main-btn:hover {
      background: linear-gradient(90deg, #1565c0 60%, #1976d2 100%);
    }
    .caregiver-main-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      opacity: 0.7;
    }
    @media (max-width: 600px) {
      .caregiver-container {
        padding: 1.2rem 0.2rem 1.2rem 0.2rem;
        max-width: 98vw;
      }
      .form-section {
        padding: 0.7rem 0.2rem 0.5rem 0.2rem;
      }
    }
    .caregiver-form input[type="number"]::-webkit-inner-spin-button,
    .caregiver-form input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .caregiver-form input[type="number"] {
      -moz-appearance: textfield;
    }
    .caregiver-form input[type="date"] {
      background: #f6f8fc;
      border-radius: 12px;
      border: none;
      box-shadow: 0 2px 8px rgba(25,118,210,0.07);
      padding: 0.95rem 1.1rem 0.95rem 2.7rem;
      font-size: 1.15rem;
      color: #222;
      font-weight: 500;
      text-align: center;
      transition: box-shadow 0.2s, background 0.2s;
      outline: none;
      margin-bottom: 0.1rem;
      margin-top: 0.1rem;
      letter-spacing: 1px;
    }
    .caregiver-form input#birthdate:focus {
      background: #e3eafc;
      box-shadow: 0 0 0 2px #1976d2;
    }
    .caregiver-form input#birthdate::placeholder {
      color: #b6c7e3;
      opacity: 1;
      text-align: center;
    }
    
    /* Estilos para los símbolos de género */
    #gender option[value="masculino"] {
      color: #1976d2;
      font-weight: 500;
    }
    #gender option[value="femenino"] {
      color: #e91e63;
      font-weight: 500;
    }
    #gender option[value=""] {
      color: #666;
    }

    /* Mensajes de error y éxito */
    .message-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 9999;
      text-align: center;
      display: none;
    }
    
    .error-field {
      border-color: #d32f2f !important;
      background-color: #ffebee !important;
    }
    
    .success-field {
      border-color: #2e7d32 !important;
      background-color: #e8f5e8 !important;
    }
  </style>
</head>
<body>
  <div id="messageBanner" class="message-banner"></div>
  <a href="login.html#register" class="back-home-btn">
    <i class="bi bi-arrow-left"></i>
    <span>Volver al registro</span>
  </a>
  <div class="caregiver-container">
    <div class="caregiver-logo">
      <div style="display:flex; align-items:center; justify-content:center; gap:2px;">
        <img src="../assets/Frame - 1.svg" alt="Careconnect Logo" style="width: 100px; height: 100px; border-radius: 0; background: transparent;">
        <span style="font-family: 'Poppins', Arial, sans-serif; font-size: 2.3rem; font-weight: 700; color: #1565c0; letter-spacing: 2.5px; text-shadow: 0 2px 6px rgba(25,118,210,0.10), 0 1px 0 #fff;">areconnect</span>
      </div>
    </div>
    <div class="caregiver-header">
      <div style="font-size:1.08rem; color:#1976d2; margin-bottom:0.5rem; font-weight:500; letter-spacing:0.5px;">Completa tu información personal y profesional</div>
    </div>
    <form class="caregiver-form" id="caregiverForm">
      <div class="form-section">
        <label for="fullName">Nombre Completo</label>
        <div class="input-group">
          <i class="bi bi-person"></i>
          <input type="text" id="fullName" name="fullName" placeholder="Tu nombre completo" required>
        </div>
        <label for="email">Correo Electrónico</label>
        <div class="input-group">
          <i class="bi bi-envelope"></i>
          <input type="email" id="email" name="email" placeholder="Tu correo electrónico" required>
        </div>
        <label for="password">Contraseña</label>
        <div class="input-group">
          <i class="bi bi-lock"></i>
          <input type="password" id="password" name="password" placeholder="Crea una contraseña" required>
        </div>
        <label for="phone">Número de Teléfono</label>
        <div class="input-group">
          <i class="bi bi-telephone"></i>
          <input type="tel" id="phone" name="phone" placeholder="Tu número de teléfono" required>
        </div>
        <label for="birthdate">Fecha de Nacimiento</label>
        <div class="input-group">
          <i class="bi bi-calendar"></i>
          <input type="text" id="birthdate" name="birthdate" required placeholder="DD-MM-YYYY (ej. 25-12-1970)" pattern="^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[0-2])-(19|20)\d\d$" maxlength="10" autocomplete="off" inputmode="numeric">
        </div>
        <label for="gender">Género</label>
        <div class="input-group">
          <i class="bi bi-gender-ambiguous"></i>
          <select id="gender" name="gender" required>
            <option value="">Seleccionar género</option>
            <option value="femenino">♀ Femenino</option>
            <option value="masculino">♂ Masculino</option>
          </select>
        </div>
        <label for="address">Dirección</label>
        <div class="input-group">
          <i class="bi bi-geo-alt"></i>
          <input type="text" id="address" name="address" placeholder="Tu dirección" required>
        </div>
      </div>
      <div class="form-section">
        <label for="experience">Experiencia (años)</label>
        <div class="input-group">
          <i class="bi bi-briefcase"></i>
          <input type="number" id="experience" name="experience" min="0" max="60" placeholder="Años de experiencia" required inputmode="numeric" style="text-align:center;">
        </div>
        <label for="education">Educación</label>
        <div class="input-group">
          <i class="bi bi-mortarboard"></i>
          <input type="text" id="education" name="education" placeholder="Tu educación" required>
        </div>
        <label for="certifications">Certificaciones</label>
        <div class="input-group">
          <i class="bi bi-award"></i>
          <input type="text" id="certifications" name="certifications" placeholder="Certificaciones (opcional)">
        </div>
        <label for="skills">Habilidades</label>
        <div class="input-group">
          <i class="bi bi-stars"></i>
          <textarea id="skills" name="skills" placeholder="Lista tus habilidades, separadas por comas" required></textarea>
        </div>
        <label for="languages">Idiomas</label>
        <div class="input-group">
          <i class="bi bi-translate"></i>
          <input type="text" id="languages" name="languages" placeholder="Idiomas que hablas" required>
        </div>
        <label for="bio">Biografía Corta</label>
        <div class="input-group">
          <i class="bi bi-chat-left-text"></i>
          <textarea id="bio" name="bio" placeholder="Cuéntanos sobre ti" required></textarea>
        </div>
        <label for="availability">Disponibilidad</label>
        <div class="input-group">
          <i class="bi bi-clock"></i>
          <select id="availability" name="availability" required>
            <option value="">Seleccionar disponibilidad</option>
            <option value="tiempo_completo">Tiempo completo</option>
            <option value="tiempo_parcial">Tiempo parcial</option>
            <option value="fines_semana">Fines de semana</option>
            <option value="noches">Noches</option>
          </select>
        </div>
      </div>
      <button type="submit" class="caregiver-main-btn" id="submitBtn">Crear Perfil</button>
    </form>
  </div>
  <script src="../js/localStorage-utils.js"></script>
  <script>
    // Función para mostrar mensajes
    function showBanner(message, type = 'success') {
      const banner = document.getElementById('messageBanner');
      if (!banner) return;
      
      const bgColor = type === 'success' ? '#d1fae5' : '#fee2e2';
      const textColor = type === 'success' ? '#065f46' : '#991b1b';
      const borderColor = type === 'success' ? '#10b981' : '#ef4444';
      
      banner.innerHTML = `
        <div style="display:inline-block;margin:16px auto;padding:16px 32px;background:${bgColor};color:${textColor};border-radius:8px;font-size:1.2rem;font-weight:bold;box-shadow:0 2px 8px rgba(0,0,0,0.08);border:1px solid ${borderColor};">
          ${message}
        </div>
      `;
      banner.style.display = 'block';
      setTimeout(() => {
        banner.style.display = 'none';
        banner.innerHTML = '';
      }, 3000);
    }

    // Función para validar campos
    function validateField(field, validationRules) {
      const value = field.value.trim();
      const fieldName = field.name || field.id;
      
      // Limpiar clases de error/éxito
      field.classList.remove('error-field', 'success-field');
      
      // Validar campo requerido
      if (validationRules.required && !value) {
        field.classList.add('error-field');
        return `El campo ${fieldName} es requerido.`;
      }
      
      if (!value) return null; // Campo vacío pero no requerido
      
      // Validar longitud mínima
      if (validationRules.minLength && value.length < validationRules.minLength) {
        field.classList.add('error-field');
        return `${fieldName} debe tener al menos ${validationRules.minLength} caracteres.`;
      }
      
      // Validar longitud máxima
      if (validationRules.maxLength && value.length > validationRules.maxLength) {
        field.classList.add('error-field');
        return `${fieldName} no puede tener más de ${validationRules.maxLength} caracteres.`;
      }
      
      // Validar formato de email
      if (validationRules.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
        field.classList.add('error-field');
        return 'Por favor ingresa un correo electrónico válido.';
      }
      
      // Validar formato de fecha
      if (validationRules.date && !/^(0?[1-9]|[12][0-9]|3[01])[\/\-\.](0?[1-9]|1[0-2])[\/\-\.](19|20)\d\d$/.test(value)) {
        field.classList.add('error-field');
        return 'Por favor ingresa una fecha válida en formato DD/MM/YYYY, DD-MM-YYYY, o DD.MM.YYYY';
      }
      
      // Validar número
      if (validationRules.number) {
        const num = parseInt(value);
        if (isNaN(num) || num < validationRules.min || num > validationRules.max) {
          field.classList.add('error-field');
          return `${fieldName} debe ser un número entre ${validationRules.min} y ${validationRules.max}.`;
        }
      }
      
      // Si pasa todas las validaciones
      field.classList.add('success-field');
      return null;
    }

    // Función para obtener usuarios
    function getUsers() {
      try {
        if (!LocalStorageUtils.isAvailable()) {
          console.warn('localStorage no está disponible');
          return [];
        }
        
        const users = LocalStorageUtils.getItem('users', []);
        return Array.isArray(users) ? users : [];
      } catch (error) {
        console.error('Error obteniendo usuarios:', error);
        return [];
      }
    }

    // Función para guardar usuarios
    function saveUsers(users) {
      try {
        if (!Array.isArray(users)) {
          throw new Error('Users debe ser un array');
        }
        
        return LocalStorageUtils.setItem('users', users, 5000000); // 5MB límite
      } catch (error) {
        console.error('Error guardando usuarios:', error);
        return false;
      }
    }

    // Función para registrar cuidador
    function registerCaregiver(formData) {
      try {
        // Verificar si localStorage está disponible
        if (!LocalStorageUtils.isAvailable()) {
          throw new Error('localStorage no está disponible en tu navegador. Por favor, habilítalo o prueba con un navegador diferente.');
        }
        
        // Obtener usuarios existentes
        let users = getUsers();
        
        // Verificar duplicados por email
        if (users.some(u => u.email === formData.email.toLowerCase())) {
          throw new Error('Ya existe un usuario registrado con este correo electrónico.');
        }
        
        // Crear nuevo usuario cuidador
        const newCaregiver = {
          username: LocalStorageUtils.sanitizeText(formData.fullName),
          email: formData.email.toLowerCase().trim(),
          password: formData.password,
          phone: LocalStorageUtils.sanitizeText(formData.phone),
          birthdate: LocalStorageUtils.normalizeDate(formData.birthdate) || formData.birthdate,
          gender: formData.gender,
          address: LocalStorageUtils.sanitizeText(formData.address),
          experience: LocalStorageUtils.sanitizeText(formData.experience),
          education: LocalStorageUtils.sanitizeText(formData.education),
          certifications: LocalStorageUtils.sanitizeText(formData.certifications),
          skills: LocalStorageUtils.sanitizeText(formData.skills),
          languages: LocalStorageUtils.sanitizeText(formData.languages),
          bio: LocalStorageUtils.sanitizeText(formData.bio),
          availability: formData.availability,
          role: 'cuidador',
          registrationDate: new Date().toISOString(),
          id: Date.now().toString() + Math.random().toString(36).substr(2, 9)
        };
        
        // Agregar nuevo usuario
        users.push(newCaregiver);
        
        // Guardar usuarios actualizados
        if (!saveUsers(users)) {
          throw new Error('Error al guardar los datos. Por favor, verifica que tienes suficiente espacio de almacenamiento.');
        }
        
        // Guardar datos de sesión
        LocalStorageUtils.setItem('loggedInUser', newCaregiver.username);
        LocalStorageUtils.setItem('userRole', newCaregiver.role);
        LocalStorageUtils.setItem('currentUserId', newCaregiver.id);
        
        return newCaregiver;
      } catch (error) {
        throw error;
      }
    }

    // Manejar envío del formulario
    document.getElementById('caregiverForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const originalText = submitBtn.textContent;
      
      // Deshabilitar botón y mostrar estado de carga
      submitBtn.disabled = true;
      submitBtn.textContent = 'Creando perfil...';
      
      try {
        // Definir reglas de validación
        const validationRules = {
          fullName: { required: true, maxLength: 100 },
          email: { required: true, maxLength: 100, email: true },
          password: { required: true, minLength: 6, maxLength: 50 },
          phone: { required: true, maxLength: 20 },
          birthdate: { required: true, date: true },
          gender: { required: true },
          address: { required: true, maxLength: 200 },
          experience: { required: true, number: true, min: 0, max: 60 },
          education: { required: true, maxLength: 100 },
          skills: { required: true, maxLength: 300 },
          languages: { required: true, maxLength: 100 },
          bio: { required: true, maxLength: 500 },
          availability: { required: true }
        };
        
        // Validar todos los campos
        const errors = [];
        const formData = {};
        
        Object.keys(validationRules).forEach(fieldName => {
          const field = document.getElementById(fieldName);
          if (field) {
            const error = validateField(field, validationRules[fieldName]);
            if (error) {
              errors.push(error);
            } else {
              formData[fieldName] = field.value.trim();
            }
          }
        });
        
        // Si hay errores, mostrarlos y detener
        if (errors.length > 0) {
          showBanner(errors.join('\n'), 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          return;
        }
        
        // Simular proceso de registro (1 segundo)
        setTimeout(() => {
          try {
            // Registrar cuidador
            const newCaregiver = registerCaregiver(formData);
            
            // Mostrar mensaje de éxito
            showBanner('¡Registro exitoso! Redirigiendo al dashboard...', 'success');
            
            // Redirigir al dashboard de cuidadores después de 1.5 segundos
            setTimeout(() => {
              window.location.href = '../dashboard/caregivers pro/Caregiver-pro.html';
            }, 1500);
            
          } catch (error) {
            console.error('Error durante el registro:', error);
            showBanner(error.message, 'error');
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        }, 1000);
        
      } catch (error) {
        console.error('Error en el formulario:', error);
        showBanner('Error inesperado. Por favor, intenta de nuevo.', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // Validación en tiempo real
    const fields = document.querySelectorAll('.caregiver-form input, .caregiver-form select, .caregiver-form textarea');
    fields.forEach(field => {
      field.addEventListener('blur', function() {
        const fieldName = this.name || this.id;
        const validationRules = {
          fullName: { required: true, maxLength: 100 },
          email: { required: true, maxLength: 100, email: true },
          password: { required: true, minLength: 6, maxLength: 50 },
          phone: { required: true, maxLength: 20 },
          birthdate: { required: true, date: true },
          gender: { required: true },
          address: { required: true, maxLength: 200 },
          experience: { required: true, number: true, min: 0, max: 60 },
          education: { required: true, maxLength: 100 },
          skills: { required: true, maxLength: 300 },
          languages: { required: true, maxLength: 100 },
          bio: { required: true, maxLength: 500 },
          availability: { required: true }
        };
        
        if (validationRules[fieldName]) {
          validateField(this, validationRules[fieldName]);
        }
      });
    });
  </script>
</body>
</html> 